@{
    var IsActive = "false";
    var IsProductEnabled = "true";
}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Canam Distributors INC</title>

    <!-- Bootstrap Core CSS -->
    <link href="~/css/bootstrap.min.css" rel="stylesheet">
    <!-- MetisMenu CSS -->
    <link href="~/css/metisMenu.min.css" rel="stylesheet">
    <!-- DataTables CSS -->
    <link href="~/css/dataTables/dataTables.bootstrap.css" rel="stylesheet">

    <!-- DataTables Responsive CSS -->
    <link href="~/css/dataTables/dataTables.responsive.css" rel="stylesheet">
    <!-- Timeline CSS -->
    <link href="~/css/timeline.css" rel="stylesheet">
    <!-- Custom CSS -->
    <link href="~/css/startmin.css" rel="stylesheet">
    <!-- Custom Fonts -->
    <link href="~/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <link href="https://cdn.jsdelivr.net/npm/froala-editor@3.2.6/css/froala_editor.pkgd.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/froala-editor@3.2.6/js/froala_editor.pkgd.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.css">
    <script src="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet" />


    <style>
        .switch {
            position: relative;
            display: inline-block;
            width: 60px;
            height: 34px;
        }

            .switch input {
                opacity: 0;
                width: 0;
                height: 0;
            }

        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #b0b0b0; /* Grey background color */
            transition: .4s;
            border-radius: 34px;
        }

            .slider:before {
                position: absolute;
                content: "";
                height: 26px;
                width: 26px;
                border-radius: 50%;
                left: 4px;
                bottom: 4px;
                background-color: white;
                transition: .4s;
            }

        input:checked + .slider {
            background-color: #4d4d4d; /* Darker grey for the checked state */
        }

            input:checked + .slider:before {
                transform: translateX(26px);
            }


        .file-input {
            display: flex;
            justify-content: center;
            align-items: center;
            width: 100%;
            height: 150px;
            border: 2px solid #ccc; /* Light grey border */
            border-radius: 8px; /* Slightly curved corners */
            background-color: rgba(240, 240, 240, 0.8); /* Foggy effect with transparency */
            color: #555; /* Darker text color */
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            position: relative;
            text-align: center;
            transition: border-color 0.3s;
        }

            .file-input input[type="file"] {
                position: absolute;
                width: 100%;
                height: 100%;
                opacity: 0; /* Hide the default file input */
                cursor: pointer;
            }

            .file-input:hover {
                border-color: #888; /* Darker grey border on hover */
            }

        #gallery {
            display: flex;
            flex-wrap: wrap;
        }

            #gallery img {
                width: 100px;
                height: auto;
                margin: 5px;
                border: 1px solid #ccc;
            }

        .modal-body {
            max-height: 400px; /* Adjust height as needed */
            overflow-y: auto; /* Enable vertical scrolling */
        }

        .image-container {
            display: inline-block;
            position: relative;
            margin-right: 5px;
            margin-bottom: 10px;
        }

            .image-container img {
                width: 100px; /* Set desired width */
                height: auto;
                margin: 5px;
            }
    </style>


</head>

<body>

    <div id="wrapper">

        <!-- Navigation -->
        <nav class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <div class="navbar-header">
                <a class="navbar-brand" href="#">Canam Distributors</a>
            </div>

            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>

            <ul class="nav navbar-nav navbar-left navbar-top-links">
                <li><a href="https://canamdistributors.com"><i class="fa fa-home fa-fw"></i> Website</a></li>
            </ul>

            <ul class="nav navbar-right navbar-top-links">
                <li class="dropdown">
                    <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                        <i class="fa fa-user fa-fw"></i> @ViewBag.AdminName <b class="caret"></b>
                    </a>
                    <ul class="dropdown-menu dropdown-user">
                        <li>
                            <a asp-controller="Account" asp-action="LogOut"><i class="fa fa-sign-out fa-fw"></i> Logout</a>
                        </li>
                    </ul>
                </li>
            </ul>
            <!-- /.navbar-top-links -->
        </nav>

        <aside class="sidebar navbar-default" role="navigation">
            <div class="sidebar-nav navbar-collapse">
                <ul class="nav" id="side-menu">
                    <li class="sidebar-search">
                        <div class="input-group custom-search-form">
                            <img src="~/images/logo.webp" alt="BootstrapBrain Logo" width="200" height="38">
                        </div>
                        <!-- /input-group -->
                    </li>
                    <li>
                        <a asp-controller="Account" asp-action="Dashboard" class="active"><i class="fa fa-home fa-fw"></i> Home</a>
                    </li>
                    <li>
                        <a href="#" class="active"><i class="fa fa-shopping-cart fa-fw"></i> Orders</a>
                    </li>
                    <li>
                        <a href="#"><i class="fa fa-tags fa-fw"></i> Sales <span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a asp-controller="Account" asp-action="Products">Products</a>
                            </li>
                            <li>
                                <a asp-controller="Account" asp-action="Collections">Collections</a>
                            </li>
                            <li>
                                <a asp-controller="Account" asp-action="DeletedCollections">Deleted Collections</a>
                            </li>
                            <li>
                                <a asp-controller="Account" asp-action="HotDeals">Hot-Deals</a>
                            </li>
                            <li>
                                <a href="#">Inventory</a>
                            </li>
                            <li>
                                <a href="#">Purchase Orders</a>
                            </li>
                            <li>
                                <a href="#"> Transfers</a>
                            </li>
                            <li>
                                <a href="#">Gift Cards</a>
                            </li>
                        </ul>
                        <!-- /.nav-second-level -->
                    </li>
                    <li>
                        <a asp-controller="Account" asp-action="Customers" class="active"><i class="fa fa-users fa-fw"></i> Customers</a>
                    </li>
                </ul>
            </div>
        </aside>
        <!-- /.sidebar -->

        <div id="page-wrapper">
            <div class="container-fluid">
                <div class="row">
                    <div class="col-lg-12">
                        @RenderBody()
                    </div>
                    <!-- /.col-lg-12 -->
                </div>
                <!-- /.row -->
            </div>
            <!-- /.container-fluid -->
        </div>
        <!-- /#page-wrapper -->

    </div>
    <!-- /#wrapper -->
    <!-- jQuery -->
    <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static" data-keyboard="false">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" onclick="CloseProductHotDealsModal()" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">Add Product Into Hot Deals</h4>
                </div>
                <div class="modal-body"
                    <fieldset>
                        <input type="hidden" id="ProductId" value="" />
                        <div class="form-group">
                            <label for="CategoryImages">Images</label>
                            <div class="file-input">
                                <input type="file" id="fileElem" name="CategoryImages" accept="image/*" multiple />
                                <span>Select files</span>
                            </div>

                            <div id="gallery" style="margin-top: 10px; display: flex; flex-wrap: wrap;"></div>
                        </div>
                        <div class="form-group">
                            <label for="ProductConditions">Description</label>
                            <textarea id="ProoductConditions" class="form-control"></textarea>
                        </div>
                        <div class="form-group">
                            <label for="Category">Hot Deal Price</label>
                            <input type="number" id="DiscountPrice" class="form-control" autofocus="true" required />
                        </div>
                    </fieldset>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" onclick="CloseProductHotDealsModal()">Close</button>
                    <button type="button" class="btn btn-primary" onclick="UpdateProductHotDeals()">Save changes</button>
                </div>
            </div>
        </div>
    </div>

    <script src="~/js/jquery.min.js"></script>
    <script src="~/js/bootstrap.min.js"></script>
    <script src="~/js/metisMenu.min.js"></script>
    <script src="~/js/dataTables/jquery.dataTables.min.js"></script>
    <script src="~/js/dataTables/dataTables.bootstrap.min.js"></script>
    <script src="~/js/startmin.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate/1.19.5/jquery.validate.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-validate-unobtrusive/3.2.11/jquery.validate.unobtrusive.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/js/select2.min.js"></script>
    <script>
        $(document).ready(function () {
            new FroalaEditor('#ProoductConditions');
            $('#dataTables-example').DataTable({
                responsive: true
            });
            $('#ProductList').select2({
                placeholder: "Select Products",
                allowClear: true,
                width: '100%' // Ensure Select2 takes full width
            });
        });

    </script>
    <script>
        var IsActive = '@IsActive'; // Use Razor to set the value
        var IsProductEnabled = '@IsProductEnabled'; // Use Razor to set the value
        var removedImages = []; // Array to keep track of removed images
        var currentImages = []; // Array to keep track of current images
        var selectedFiles = []; // Array to track newly selected files

        function handleCheckboxChange(checkbox, id, discountPrice, imageUrls, description, IsProductActive) {
            $('#ProductId').val(id);
            $('#DiscountPrice').val(discountPrice);
            // $('#ProoductConditions').val(description);
            var editorInstance = new FroalaEditor('#ProoductConditions');

            // Set content after initialization using the API
            editorInstance.html.set(description);
            $('#ProoductConditions').froalaEditor('html.set', description);


            // Clear previous images from the gallery
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = '';
            currentImages = []; // Reset current images

            // Split the image URLs into an array
            var imagesArray = imageUrls.split('|');

            // Loop through the images array and create image elements
            imagesArray.forEach(function (imageData) {
                if (imageData) {
                    const formattedImage = formatBase64Image(imageData); // Format the base64 string
                    currentImages.push(formattedImage); // Store current images
                    const container = createImageContainer(formattedImage); // Create image container
                    gallery.appendChild(container); // Append to the gallery
                }
            });

            // Handle checkbox state
            if (checkbox.checked) {
                IsProductEnabled = "true";
                $('#myModal').modal('show');
                $('#myModal').data('relatedCheckbox', checkbox);
            } else {
                IsProductEnabled = "false";
                $('#DiscountPrice').val(1);
                UpdateProductHotDeals();
                $('#myModal').modal('hide'); // Close modal if needed
            }

            // Handle checkbox state
            if (IsProductActive == "false") {
                if (checkbox.checked) {
                    IsActive = "true";
                    $('#myModal').modal('show');
                    $('#myModal').data('relatedCheckbox', checkbox);
                } else {
                    IsActive = "false";
                    $('#DiscountPrice').val(0);
                    UpdateProductHotDeals();
                    $('#myModal').modal('hide'); // Close modal if needed
                }
            }
        }

        // Create image container with the view and remove buttons
        function createImageContainer(imageUrl) {
            const container = document.createElement('div');
            container.classList.add('image-container');
            container.style.position = 'relative'; // Ensure button is positioned relative to the image

            const img = document.createElement('img');
            img.src = imageUrl;
            img.style.width = '100px'; // Initial small size for gallery
            img.style.height = '100px';
            img.style.display = 'block'; // Image is displayed as block

            // Create the "View" button
            const viewButton = document.createElement('button');
            viewButton.textContent = 'View';
            viewButton.classList.add('btn', 'btn-primary', 'btn-sm');
            viewButton.style.marginRight = '5px'; // Adding some space between buttons
            viewButton.onclick = function () {
                openImageInNewTab(imageUrl); // Open image in a new tab
            };

            // Create the "Remove" button
            const removeButton = document.createElement('button');
            removeButton.textContent = 'Remove';
            removeButton.classList.add('remove-image', 'btn', 'btn-danger', 'btn-sm');
            removeButton.onclick = function () {
                handleImageRemoval(imageUrl); // Track the removed image
                container.remove(); // Remove image container on click
            };

            // Append the image, view button, and remove button to the container
            container.appendChild(img);
            container.appendChild(viewButton); // Add the View button
            container.appendChild(removeButton); // Add the Remove button

            return container;
        }


        // Function to open the image in a new tab
        function openImageInNewTab(imageUrl) {
            const newWindow = window.open();
            newWindow.document.write('<img src="' + imageUrl + '" alt="Image" style="width: 100%; height: auto;">');
        }

        // Function to handle image removal
        function handleImageRemoval(imageUrl) {
            removedImages.push(imageUrl); // Track the removed image
            const index = currentImages.indexOf(imageUrl);
            if (index > -1) {
                currentImages.splice(index, 1); // Remove from current images
            }
        }

        // Existing UpdateProductHotDeals function
        function UpdateProductHotDeals() {
            var productIdValue = $('#ProductId').val();
            var discountPriceValue = $('#DiscountPrice').val();
            var description = $('#ProoductConditions').val();

            if (IsProductEnabled == "false" && discountPriceValue == 0) {
                showToast('Discount Price is required!', 'error');
                $('#myModal').modal('show');
                return;
            }

            var formData = new FormData();
            formData.append('productId', productIdValue);
            formData.append('discountPrice', discountPriceValue);
            formData.append('active', IsActive);
            formData.append('description', description);
            formData.append('IsProductEnabled', IsProductEnabled);

            // Append removed images
            removedImages.forEach(function (image) {
                formData.append('removedImages', image);
            });

            // Append current images as URLs
            currentImages.forEach(function (imageUrl) {
                formData.append('currentImages', imageUrl); // Append URL directly
            });

            // Handle newly selected images
            selectedFiles.forEach(function (file) {
                formData.append('CategoryImages', file); // These should be File objects
            });

            // AJAX call to update the product
            $.ajax({
                url: '/Account/UpdateHotDealProduct',
                type: 'POST',
                data: formData,
                processData: false,
                contentType: false,
                success: function (response) {
                    if (response.success) {
                        showToast('Product updated successfully!', 'success');
                        $('#myModal').modal('hide');
                        $('#ProductId').val("");
                        setTimeout(function () {
                            location.reload();
                        }, 1000);
                    } else {
                        showToast(response.message || 'Error updating product!', 'error');
                        $('#myModal').modal('show');
                    }
                },
                error: function (xhr, status, error) {
                    showToast('An error occurred: ' + error, 'error');
                    $('#myModal').modal('show');
                }
            });
        }

        function showToast(message, type) {
            Toastify({
                text: message,
                duration: 3000,
                gravity: 'top',
                position: 'right',
                backgroundColor: type === 'success' ? 'green' : 'red',
                className: type,
            }).showToast();
        }

        document.addEventListener('DOMContentLoaded', function () {
            const fileInput = document.getElementById('fileElem');
            const gallery = document.getElementById('gallery');

            fileInput.addEventListener('change', function (event) {
                const files = event.target.files;
                selectedFiles = []; // Reset selected files array

                Array.from(files).forEach(file => {
                    const container = createNewImageContainer(URL.createObjectURL(file));
                    gallery.appendChild(container);
                    selectedFiles.push(file); // Add to selected files array
                });
            });
        });

        function createNewImageContainer(imageSrc) {
            const container = document.createElement('div');
            container.classList.add('image-container');

            const img = document.createElement('img');
            img.src = imageSrc;

            const viewButton = document.createElement('button');
            viewButton.textContent = 'View';
            viewButton.classList.add('btn', 'btn-primary', 'btn-sm');
            viewButton.style.marginRight = '5px'; // Adding some space between buttons
            viewButton.onclick = function () {
                openImageInNewTab(imageSrc); // Open image in a new tab
            };

            const removeButton = document.createElement('button');
            removeButton.textContent = 'Remove';
            removeButton.classList.add('remove-image', 'btn', 'btn-danger', 'btn-sm');
            removeButton.onclick = function () {
                container.remove(); // Remove image container on click
                // Logic to remove from selected files
                const index = selectedFiles.indexOf(img.src);
                if (index > -1) {
                    selectedFiles.splice(index, 1);
                }
            };

            container.appendChild(img);
            container.appendChild(viewButton); // Add the View button
            container.appendChild(removeButton);
            return container;
        }

        function formatBase64Image(imageData) {
            // Check if the imageData already has the prefix
            if (!imageData.startsWith('data:image/')) {
                // Assuming the image format is PNG. Change it if necessary.
                imageData = 'data:image/png;base64,' + imageData;
            }
            return imageData;
        }

        function EditHotDealProduct(productId, discountPrice, imageUrls, description, IsProductActive) {
            IsActive = "true";
            IsProductEnabled = IsProductActive;
            $('#ProductId').val(productId);
            $('#DiscountPrice').val(discountPrice);
            $('#Description').val(description);

            // Clear previous images from the gallery
            const gallery = document.getElementById('gallery');
            gallery.innerHTML = '';
            currentImages = []; // Reset current images

            // Split the image URLs into an array
            var imagesArray = imageUrls.split('|');

            // Loop through the images array and create image elements
            imagesArray.forEach(function (imageData) {
                if (imageData) {
                    const formattedImage = formatBase64Image(imageData); // Format the base64 string
                    currentImages.push(formattedImage); // Store current images
                    const container = createImageContainer(formattedImage); // Create image container
                    gallery.appendChild(container); // Append to the gallery
                }
            });
            $('#myModal').modal('show');
        }

        function CloseProductHotDealsModal() {
            var productIdValue = $('#ProductId').val();
            var chckBoxId = "toggleStatus_" + productIdValue;
            // Uncheck the checkbox
            IsActive = "false";
            $('#myModal').modal('hide'); // Close modal if needed
            $('#' + chckBoxId).prop('checked', false);
        }

        function DeleteCollection(categoryId) {
            $.ajax({
                url: '/Account/DeleteCollection',
                type: 'POST',
                data: {
                    categoryId: categoryId
                },
                success: function (response) {
                    if (response.success) {
                        showToast('Collection deleted successfully!', 'success');
                        setTimeout(function () {
                            location.reload(); // Reload the page after a delay
                        }, 1000);
                    } else {
                        showToast(response.message || 'Error deleting collection!', 'error');
                    }
                },
                error: function (xhr, status, error) {
                    showToast('An error occurred: ' + error, 'error');
                }
            });
        }

        function UpdateCollectionStatus(checkbox, categoryId) {
            var IsCollectionStatus;
            if (checkbox.checked) {
                IsCollectionStatus = true;
            } else {
                IsCollectionStatus = false;
            }
            $.ajax({
                url: '/Account/UpdateCollectionStatus',
                type: 'POST',
                data: {
                    IsCollectionStatus: IsCollectionStatus,
                    categoryId: categoryId
                },
                success: function (response) {
                    if (response.success) {
                        showToast('Collection status updated successfully!', 'success');
                        setTimeout(function () {
                            location.reload(); // Reload the page after a delay
                        }, 1000);
                    } else {
                        showToast(response.message || 'Error status updation collection!', 'error');
                    }
                },
                error: function (xhr, status, error) {
                    showToast('An error occurred: ' + error, 'error');
                }
            });
        }

    </script>


</body>

</html>